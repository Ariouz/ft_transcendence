<div class="matchmaking_container">
    <h2 data-i18n="matchmaking_looking_for_oppponent"></h2>
    <div class="matchmaking_cards">
        <div class="matchmaking_card">
            <div class="matchmaking_avatar_container">
                <img src="../../assets/images/default_avatar.svg" alt="avatar" class="rounded-circle" id="matchmaking_user_avatar" style="max-width: 180px; height: auto;">
            </div>
        </div>
        <div class="spinner-border matchmaking_loading_spinner" role="status"> <span class="visually-hidden">Loading...</span> </div>
        <div class="matchmaking_card">
            <div class="matchmaking_avatar_container">
                <img src="../../assets/images/default_avatar.svg" alt="avatar" class="rounded-circle" id="" style="max-width: 180px; height: auto;">
            </div>
        </div>
    </div>
</div>

<div class="matchmaking_leave_queue_button" onclick="leaveMatchmakingQueue()">
    <span data-i18n="matchmaking_leave_queue"></span>
</div>

<script>
    async function loadData()
    {
        token = getCookie("session_token");
        userData = await retrieveSettings(token);
        if (userData.error)
        {
            navigate("/login");
            return ;
        }
        document.getElementById("matchmaking_user_avatar").src = userData.avatar;
    }

    // fetch(this.action, {
    //         method: 'POST',
    //         body: formData,
    //     })
    //     .then(response => response.json())
    //     .then(data => {
    //         hideLoadingWheel();
    //         if (data.error)
    //             showError(data.error, data.details);
    //         else
    //             showSuccess(data.success)
    //     })
    //     .catch(error => {
    //         showError(error.error, error.details);
    //         hideLoadingWheel();
    //     })

    sessionToken = getCookie("session_token");
    
    async function joinQueue()
    {
        let url = `${PONG_QUEUE_API}/join/`;

        let userId = await retrieveId(sessionToken);
        console.log(userId.user_id);
        let requestData = { user_id: userId.user_id };

        data = fetch(url, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(requestData),
        }).then(data => data.json())
        .then(data => {
            console.log(data);
        }).catch(error => {
            console.log(error);
        });
    }

    async function leaveMatchmakingQueue()
    {
        let url = `${PONG_QUEUE_API}/leave/`;

        let userId = await retrieveId(sessionToken);
        console.log(userId.user_id);
        let requestData = { user_id: userId.user_id };

        data = fetch(url, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(requestData),
        }).then(data => data.json())
        .then(data => {
            console.log(data);
            navigate("/pong");
        }).catch(error => {
            console.log(error);
        });
    }

    loadData();
    joinQueue();
</script>